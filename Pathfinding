local Pathfinding = {}

local PathfindingService = game:GetService("PathfindingService")
local WaypointFolder = Instance.new("Folder",game:GetService("Workspace"))
local Debris = game:GetService("Debris")
getgenv().Mode = getgenv().Mode or "Both" 





getgenv().AgentRadius = getgenv().AgentRadius or 2

getgenv().AgentHeight = getgenv().AgentHeight or 1


getgenv().CanJump = getgenv().CanJump or true

getgenv().CanClimb = getgenv().CanClimb or true


function Pathfinding:GenerateRandomString()

local Chars = "abcdefghijklnmgxyzADCERGHDYYIJRDCCSXFOPPGRD123456789"

local Word = ""

for i = 1, 25 do
local Letter = math.random(1, #Chars)

Word = Word .. Chars:sub(Letter,Letter)
end

return Word
end

WaypointFolder.Name = Pathfinding:GenerateRandomString()

local LocalPlayer = game:GetService("Players").LocalPlayer

local OldPart = nil


function Pathfinding:CreateWaypoint(CF)
local Part = Instance.new("Part", WaypointFolder) Part.CanCollide = false
 Part.CanTouch = false 
Part.CanQuery = false
Part.Shape = "Ball" 
Part.Position = CF 
Part.Color = Color3.new(1, 0, 0)
Part.Size = Vector3.new(1.5, 1, 1.5) 
Part.Anchored = true
Debris:AddItem(Part, 2)

end
function Pathfinding:RemoveWaypoints()
WaypointFolder:ClearAllChildren()
end
local ShouldStop = false

function Pathfinding:ForceStop()
ShouldStop = true
WaypointFolder:ClearAllChildren()
repeat task.wait() 
LocalPlayer.Character.Humanoid:MoveTo(LocalPlayer.Character.HumanoidRootPart.Position)
until LocalPlayer.Character.Humanoid.MoveDirection.Magnitude < 0.4
task.wait(1)
ShouldStop = false
end

local OldMode
local IsWalking = false

function Pathfinding:WalkTo(Part)
if OldPart ~= Part then
IsWalking = false
end
if IsWalking then return end
IsWalking = true
if OldPart == nil then
OldPart = Part
end
if OldMode == nil then
OldMode = getgenv().Mode
end


 
if LocalPlayer.Character then
local GetRealPosition = Part:IsA("BasePart") and Part.Position or Part:IsA("Model") and Part:GetPivot().Position or nil
if GetRealPosition == nil then
print("bro get a real part or real model and stop trolling")
return
end
task.spawn(function()
repeat task.wait() until (LocalPlayer.Character.HumanoidRootPart.Position  - GetRealPosition).Magnitude < 6 
IsWalking = false

end)
local dis = (LocalPlayer.Character.HumanoidRootPart.Position - GetRealPosition).Magnitude
if dis < 2 then return end
local  path = PathfindingService:CreatePath({
AgentRadius = getgenv().AgentRadius,
AgentHeight = getgenv().AgentHeight,
WaypointSpacing = 3,
AgentCanJump = getgenv().CanJump,
AgentCanClimb = getgenv().CanClimb
})
path:ComputeAsync(LocalPlayer.Character.HumanoidRootPart.Position,GetRealPosition)

if path.Status == Enum.PathStatus.Success then  
Pathfinding:RemoveWaypoints()
local waypoints = path:GetWaypoints()
for _, waypoint in pairs(waypoints) do
if getgenv().Mode == "Show" or getgenv().Mode == "Both" then
Pathfinding:CreateWaypoint(waypoint.Position)
end
if getgenv().Mode == "Walk" then
Pathfinding:RemoveWaypoints()
end

end
for i, waypoint in pairs(waypoints) do
if not IsWalking then 
break end 
if OldMode ~= getgenv().Mode then
OldMode = getgenv().Mode
break
end
if ShouldStop then break end
if waypoint.Action == Enum.PathWaypointAction.Jump then 
LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping) end
if OldPart ~= Part then
Pathfinding:RemoveWaypoints()
OldPart = Part 

break end

local CloseCheck = (LocalPlayer.Character.HumanoidRootPart.Position - waypoint.Position).Magnitude
if CloseCheck > 4 then
if getgenv().Mode == "Walk" or getgenv().Mode == "Both" then
LocalPlayer.Character.Humanoid:MoveTo(waypoint.Position)


LocalPlayer.Character.Humanoid.MoveToFinished:Wait()
end
end

end

end

end
end
return Pathfinding
