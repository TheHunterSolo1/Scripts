local Library = {}
getgenv().ESPLibrary = Library

local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = game.Players.LocalPlayer

local Updating = true




local ESPTable = {}
local TracersTable = {}

local ShowDis = ShowDis or false

local EnableHighlight = true

local SetTracers = false

function Library:ShowDistance(Value)

ShowDis = Value

end

local function CreateTracers(part,Color)
if Drawing then
local line = Drawing.new("Line")
line.Color = Color or Color3.new(1, 1, 1)
line.Thickness = 1
line.Visible = SetTracers
table.insert(TracersTable, line)

end

end

function Library:AddESP(Part, Txt, Color,Type)
if Part:FindFirstChild("ESP_System") then return end


EnableHighlight = true

if Type == "NoHighlight" then

EnableHighlight = false
end
CreateTracers(Part, Color)

table.insert(ESPTable, Part)

local Highlight = Instance.new("Highlight",Part)
Highlight.Name = "ESP_System"
Highlight.FillColor = Color
Highlight.Enabled = EnableHighlight 
Highlight.Adornee = Part
Highlight.FillTransparency = 0.7
Highlight.OutlineTransparency = 0.4


local BillboardGui = Instance.new("BillboardGui", Part)
BillboardGui.Name = "ESP_GUI"
BillboardGui.Size = UDim2.new(0, 1, 0, 1)
BillboardGui.MaxDistance = math.huge
BillboardGui.Enabled = true
BillboardGui.AlwaysOnTop = true



local TextLabel = Instance.new("TextLabel", BillboardGui)
TextLabel.Text = Txt
TextLabel.TextSize = 19
TextLabel.Size = UDim2.new(0, 1,0, 1)
TextLabel.Font = Enum.Font.Highway
TextLabel.TextColor3 = Color
TextLabel.Name = "Txt"
TextLabel.TextYAlignment = "Bottom"
TextLabel.TextStrokeTransparency = 0

local UIScale2 = Instance.new("UIScale",TextLabel)
UIScale2.Scale = 1

local TextLabel2 = Instance.new("TextLabel", BillboardGui)
TextLabel2.Text = "0"
TextLabel2.TextSize = 18
TextLabel2.Size = UDim2.new(0, 1,0, 1)
TextLabel2.TextColor3 = Color3.new(1, 1, 1)
TextLabel2.Name = "DistanceMarker"
TextLabel2.Font = Enum.Font.Highway
TextLabel2.TextStrokeTransparency = 0
TextLabel2.TextYAlignment = "Top"
TextLabel2.Visible = ShowDis
local UIScale = Instance.new("UIScale",TextLabel2)
UIScale.Scale = 1




end

function Library:RemoveESP(Part)

for i, part in pairs(ESPTable) do
if part == Part then
table.remove(ESPTable, i)
break
end
end

for _, v in ipairs(Part:GetChildren()) do
if v.Name == "ESP_System" or v.Name == "ESP_GUI"  then
v:Destroy()
end
end

end


function Library:GenerateRandomString()
return HttpService:GenerateGUID(false)
end

function Library:SetTracers(Value)
SetTracers = Value
end

function Library:Unload()

Updating = false
for _, Object in ipairs(ESPTable) do
if Object and Object:FindFirstChild("ESP_GUI") and Object:FindFirstChild("ESP_GUI"):FindFirstChild("DistanceMarker") then
Object:FindFirstChild("ESP_GUI"):Destroy()
Object:FindFirstChild("ESP_System"):Destroy()
ESPTable = {}
end
end

getgenv().ESPLibrary = nil


end

task.spawn(function()
while task.wait(0.07) do
if Updating == false then print("Break") break end
if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then


for _, Object in ipairs(ESPTable) do
if Object and Object:FindFirstChild("ESP_GUI") and Object:FindFirstChild("ESP_GUI"):FindFirstChild("DistanceMarker") then

Object:FindFirstChild("ESP_GUI"):FindFirstChild("DistanceMarker").Visible = ShowDis

if Workspace.CurrentCamera ~= nil then

for _, Tracer in pairs(TracersTable) do
if Tracer then
local Pos2 = Object:IsA("Model") and Object:GetPivot().Position or Object:IsA("BasePart") and Object.Position or Vector3.new(0, 0, 0)

if Workspace.CurrentCamera:WorldToViewportPoint(Pos2) and SetTracers == true then
Tracer.Visible = true
elseif not Workspace.CurrentCamera:WorldToViewportPoint(Pos2) or SetTracers == false then
Tracer.Visible = false
end
local Place = workspace.CurrentCamera:WorldToViewportPoint(Pos2)

Tracer.From = Vector2.new(workspace.CurrentCamera.ViewportSize.X / 2, Workspace.CurrentCamera.ViewportSize.Y)
Tracer.To = Vector2.new(Place.X, Place.Y)



end
end

local FOV = Workspace.CurrentCamera.FieldOfView

if FOV == 120 then
Object:FindFirstChild("ESP_GUI"):FindFirstChild("DistanceMarker").UIScale.Scale = 2
Object:FindFirstChild("ESP_GUI"):FindFirstChild("Txt").UIScale.Scale = 2
elseif FOV == 80 then
Object:FindFirstChild("ESP_GUI"):FindFirstChild("Txt").UIScale.Scale = 1.5
Object:FindFirstChild("ESP_GUI"):FindFirstChild("DistanceMarker").UIScale.Scale = 1.5
elseif FOV > 80  then
Object:FindFirstChild("ESP_GUI"):FindFirstChild("Txt").UIScale.Scale = 2
Object:FindFirstChild("ESP_GUI"):FindFirstChild("DistanceMarker").UIScale.Scale = 2

elseif FOV == 70 then
Object:FindFirstChild("ESP_GUI"):FindFirstChild("Txt").UIScale.Scale = 1
Object:FindFirstChild("ESP_GUI"):FindFirstChild("DistanceMarker").UIScale.Scale = 1
end


end




local Pos = Object:IsA("Model") and Object:GetPivot().Position or Object:IsA("BasePart") and Object.Position or Vector3.new(0, 0, 0)

local Distance = (LocalPlayer.Character.HumanoidRootPart.Position - Pos).Magnitude
Object:FindFirstChild("ESP_GUI"):FindFirstChild("DistanceMarker").Text = "[" .. math.floor(Distance) .. "m]" 

end

end

end 



end

end)

 return Library